###
### 1. 회원 (User) API
### =======================================

### 1-1. 회원가입 (성공)
# (가장 먼저 실행하세요)
POST http://localhost:8080/api/users/signup
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "password123!",
  "name": "홍길동",
  "address": "서울시 강남구"
}

### 1-2. 회원가입 (실패 - 이메일 중복)
POST http://localhost:8080/api/users/signup
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "password123!",
  "name": "김중복",
  "address": "서울시 서초구"
}

### 1-3. 로그인 (성공) -> JWT 토큰 발급
# [중요!] 이 요청이 성공하면, 아래 스크립트가 실행되어
# 'auth_token'이라는 전역 변수에 "Bearer [토큰값]"이 저장됩니다.
POST http://localhost:8080/api/users/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "password123!"
}
> {%
    client.global.set("auth_token", "Bearer " + response.body.accessToken);
%}

### 1-4. 로그인 (실패 - 비밀번호 오류)
POST http://localhost:8080/api/users/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "wrongpassword"
}


###
### 2. 상품 (Product) API
### =======================================

### 2-1. 상품 등록 (실패 - 토큰 없음)
# SecurityConfig에서 POST /api/products 는 'authenticated'이므로
# 401(Unauthorized) 또는 403(Forbidden)이 발생해야 합니다.
POST http://localhost:8080/api/products
Content-Type: application/json

{
  "name": "고급 키보드",
  "price": 150000,
  "stockQuantity": 50,
  "description": "기계식 키보드입니다."
}

### 2-2. 상품 등록 (성공 - 토큰 사용)
# [주의!] 이 테스트 전에 반드시 '### 1-3. 로그인 (성공)'을 먼저 실행해야 합니다.
# Authorization 헤더에 {{auth_token}} 변수가 사용됩니다.
POST http://localhost:8080/api/products
Authorization: {{auth_token}}
Content-Type: application/json

{
  "name": "고급 키보드",
  "price": 150000,
  "stockQuantity": 50,
  "description": "기계식 키보드입니다."
}

### 2-3. 상품 등록 (성공 - 두 번째 상품)
POST http://localhost:8080/api/products
Authorization: {{auth_token}}
Content-Type: application/json

{
  "name": "게이밍 마우스",
  "price": 85000,
  "stockQuantity": 100,
  "description": "RGB가 빛나는 마우스."
}

### 2-4. 모든 상품 조회 (성공 - 토큰 불필요)
# SecurityConfig에서 GET /api/products 는 'permitAll'이므로
# 토큰 없이도 항상 성공해야 합니다.
GET http://localhost:8080/api/products

### 2-5. 단일 상품 조회 (성공 - 토큰 불필요)
# (상품 등록 후 ID 1번 조회)
GET http://localhost:8080/api/products/1


###
### 3. 주문 (Order) API (보안 적용 확인)
### =======================================

### 3-1. 주문 생성 (실패 - 토큰 없음)
# 'authenticated' API이므로 401/403 오류가 발생해야 합니다.
POST http://localhost:8080/api/orders
Content-Type: application/json

{
  "orderItems": [
    { "productId": 1, "count": 1 }
  ]
}

### 3-2. 주문 생성 (성공 - 토큰 사용)
# [수정 완료] "userId" 필드 삭제됨.
# User 1번이 Product 1번(키보드) 1개, Product 2번(마우스) 2개를 주문합니다.
POST http://localhost:8080/api/orders
Authorization: {{auth_token}}
Content-Type: application/json

{
  "orderItems": [
    {
      "productId": 1,
      "count": 1
    },
    {
      "productId": 2,
      "count": 2
    }
  ]
}

### 3-3. 주문 생성 (실패 - 재고 부족)
# [수정 완료] "userId" 필드 삭제됨.
# Product 1번(키보드)의 재고가 (50 - 1) = 49개 남은 상태입니다.
# 49개보다 많은 100개를 주문 시도 -> 400 Bad Request (재고 부족)
POST http://localhost:8080/api/orders
Authorization: {{auth_token}}
Content-Type: application/json

{
  "orderItems": [
    {
      "productId": 1,
      "count": 100
    }
  ]
}



### =======================================
### 4. 주문 조회 / 취소 API
### =======================================

### 4-1. 내 주문 목록 조회 (GET)
GET http://localhost:8080/api/orders/my
Authorization: {{auth_token}}


### 4-2. 주문 취소 (POST)
# [주의!] '### 1-3. 로그인'이 실행된 상태여야 합니다.
# 3-2에서 생성한 주문(ID: 1)을 취소합니다.
# (만약 3-2 테스트를 여러 번 해서 주문 ID가 1이 아니라면 {orderId}를 바꿔주세요)
POST http://localhost:8080/api/orders/1/cancel
Authorization: {{auth_token}}

### 4-3. (확인) 주문 취소 후 재고 원복 확인
# 4-2 실행 후, 이 요청을 다시 실행해 보세요.
# Product 1번(키보드) 재고: 49 -> 50
# Product 2번(마우스) 재고: 98 -> 100
# [참고] 이 테스트는 DB를 직접 확인하는 것이 더 정확합니다.
GET http://localhost:8080/api/products

### 4-4. (확인) 주문 취소 후 주문 상태 확인
# 4-2 실행 후, 이 요청을 다시 실행해 보세요.
# orderId: 1번 주문의 "orderStatus"가 "CANCEL"로 변경되었는지 확인합니다.
GET http://localhost:8080/api/orders/my
Authorization: {{auth_token}}

### =======================================
### 5. 상품 수정 / 삭제 API
### =======================================

### 5-1. 상품 수정 (PUT - 실패 / 토큰 없음)
# ID 1번 상품(키보드)의 가격을 수정 시도 -> 401/403 에러 발생해야 함
PUT http://localhost:8080/api/products/1
Content-Type: application/json

{
  "name": "수정된 키보드",
  "price": 155000,
  "stockQuantity": 49,
  "description": "가격이 수정되었습니다."
}

### 5-2. 상품 수정 (PUT - 성공 / 토큰 사용)
# [주의!] '### 1-3. 로그인'이 실행된 상태여야 합니다.
PUT http://localhost:8080/api/products/1
Authorization: {{auth_token}}
Content-Type: application/json

{
  "name": "수정된 키보드",
  "price": 155000,
  "stockQuantity": 49,
  "description": "가격이 수정되었습니다."
}

### 5-3. (확인) 상품 수정 결과 확인
# 토큰 없이도 조회(GET)는 가능해야 함
GET http://localhost:8080/api/products/1

### 5-4. 상품 삭제 (DELETE - 실패 / 토큰 없음)
# ID 2번 상품(마우스) 삭제 시도 -> 401/403 에러 발생해야 함
DELETE http://localhost:8080/api/products/2

### 5-5. 상품 삭제 (DELETE - 성공 / 토큰 사용)
# [주의!] '### 1-3. 로그인'이 실행된 상태여야 합니다.
DELETE http://localhost:8080/api/products/2
Authorization: {{auth_token}}

### 5-6. (확인) 상품 삭제 결과 확인
# ID 2번 상품 조회 시도 -> 404 Not Found 에러가 발생해야 함
GET http://localhost:8080/api/products/2


### =======================================
### 6. 장바구니 (Cart) API
### =======================================

### 6-1. (테스트) 새 유저로 회원가입
# 장바구니는 유저별로 생성되므로, 깨끗한 테스트를 위해
# 새 유저(cart_user@example.com)를 생성합니다.
POST http://localhost:8080/api/users/signup
Content-Type: application/json

{
  "email": "cart_user@example.com",
  "password": "password123!",
  "name": "장바구니",
  "address": "서울시"
}

### 6-2. (테스트) 새 유저로 로그인
# 이 유저(cart_user)의 토큰을 'auth_token' 변수에 (덮어)저장합니다.
POST http://localhost:8080/api/users/login
Content-Type: application/json

{
  "email": "cart_user@example.com",
  "password": "password123!"
}
> {%
    client.global.set("auth_token", "Bearer " + response.body.accessToken);
%}


### 6-3. 내 장바구니 조회 (GET - 비어있음)
# [주의!] '### 6-2. 새 유저 로그인'이 실행된 상태여야 합니다.
# 방금 가입했으므로 "cartItems": [] (빈 배열)이 나와야 정상입니다.
GET http://localhost:8080/api/cart
Authorization: {{auth_token}}


### 6-4. 장바구니에 상품 추가 (POST) - 1번 상품 2개
# 1번 상품(키보드) 2개를 장바구니에 담습니다.
# (1번 상품이 존재하지 않으면 ### 2-2 를 먼저 실행하세요)
POST http://localhost:8080/api/cart
Authorization: {{auth_token}}
Content-Type: application/json

{
  "productId": 1,
  "count": 2
}

### 6-5. 장바구니에 상품 추가 (POST) - 1번 상품 3개 더 (수량 증가 테스트)
# 1번 상품(키보드) 3개를 *추가로* 담습니다.
# CartService의 "수량 더하기" 로직이 실행되어야 합니다.
POST http://localhost:8080/api/cart
Authorization: {{auth_token}}
Content-Type: application/json

{
  "productId": 1,
  "count": 3
}

### 6-6. (확인) 내 장바구니 조회 (GET)
# 6-4와 6-5의 결과가 합쳐져,
# 1번 상품(키보드)의 수량(count)이 5개로 나와야 합니다.
GET http://localhost:8080/api/cart
Authorization: {{auth_token}}